{% extends 'base.html' %}
{% load static %}

{% block title %}Portfolio - Abruisdev | Web Dasturchi{% endblock %}

{% block meta_description %}Abruisdev - Web dasturchi, React, Django, JavaScript specialisti. Yaratilgan loyihalar va real ishlanmalar.{% endblock %}

{% block content %}
<!-- Portfolio Page -->
<section class="courses-page">
    <div class="container">
        <!-- Portfolio Header -->
        <div class="courses-header">
            <span class="section-badge">
                <i class="fas fa-briefcase"></i> Portfolio
            </span>
            <h1>Mening <span class="highlight">Loyihalarim</span></h1>
            <p>{{ portfolios.count|default:'10+' }} ta professional loyiha. Web dasturchi sifatida yaratilgan real ishlanmalar</p>
        </div>

        <!-- Category Filters -->
        <div class="filters">
            <a href="?category=" class="filter-btn {% if not selected_category %}active{% endif %}">
                <i class="fas fa-th-large"></i> Barchasi
            </a>
            {% for category in categories %}
                <a href="?category={{ category.id }}"
                   class="filter-btn {% if selected_category|stringformat:'s' == category.id|stringformat:'s' %}active{% endif %}">
                    <i class="{{ category.icon }}"></i> {{ category.title }}
                </a>
            {% empty %}
                <a href="?category=web" class="filter-btn">
                    <i class="fas fa-globe"></i> Web Saytlar
                </a>
                <a href="?category=mobile" class="filter-btn">
                    <i class="fas fa-mobile-alt"></i> Mobil Ilovalar
                </a>
                <a href="?category=api" class="filter-btn">
                    <i class="fas fa-server"></i> API
                </a>
                <a href="?category=bot" class="filter-btn">
                    <i class="fab fa-telegram"></i> Telegram Bot
                </a>
            {% endfor %}
        </div>

        <!-- Portfolio Grid -->
        {% if portfolios %}
            <div class="portfolio-grid">
                {% for portfolio in portfolios %}
                    <article class="portfolio-card">
                        <div class="portfolio-image">
                            {% if portfolio.image %}
                                <img src="{{ portfolio.image.url }}"
                                     alt="{{ portfolio.title }}"
                                     loading="lazy">
                            {% else %}
                                <div class="portfolio-placeholder">
                                    <i class="fas fa-laptop-code"></i>
                                </div>
                            {% endif %}

                            <!-- Hover Overlay -->
                            <div class="portfolio-overlay">
                                <div class="overlay-links">
                                    {% if portfolio.get_demo_url %}
                                        <a href="{{ portfolio.get_demo_url }}"
                                           target="_blank"
                                           rel="noopener noreferrer"
                                           class="overlay-link"
                                           title="Demo ko'rish">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    {% endif %}
                                    {% if portfolio.get_github_url %}
                                        <a href="{{ portfolio.get_github_url }}"
                                           target="_blank"
                                           rel="noopener noreferrer"
                                           class="overlay-link"
                                           title="GitHub">
                                            <i class="fab fa-github"></i>
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Content Section -->
                        <div class="portfolio-content">
                            <span class="course-category">
                                {{ portfolio.category.title|upper|default:'WEB' }}
                            </span>
                            <h3 class="portfolio-title">{{ portfolio.title }}</h3>
                            <p class="portfolio-description">{{ portfolio.description }}</p>

                            <!-- Technology Tags -->
                            <div class="tech-tags">
                                {% for tech in portfolio.get_technologies_list %}
                                    <span class="tech-tag">{{ tech }}</span>
                                {% empty %}
                                    <span class="tech-tag">Python</span>
                                    <span class="tech-tag">Django</span>
                                    <span class="tech-tag">PostgreSQL</span>
                                {% endfor %}
                            </div>

                            <!-- Footer -->
                            <div class="portfolio-footer">
                                <span class="portfolio-year">
                                    <i class="fas fa-calendar-alt"></i>
                                    {{ portfolio.year|default:portfolio.created_at.year|default:'2024' }}
                                </span>
                                <div class="portfolio-links">
                                    {% if portfolio.get_demo_url %}
                                        <a href="{{ portfolio.get_demo_url }}"
                                           target="_blank"
                                           rel="noopener noreferrer"
                                           class="portfolio-link"
                                           title="Demo">
                                            <i class="fas fa-external-link-alt"></i>
                                        </a>
                                    {% endif %}
                                    {% if portfolio.get_github_url %}
                                        <a href="{{ portfolio.get_github_url }}"
                                           target="_blank"
                                           rel="noopener noreferrer"
                                           class="portfolio-link"
                                           title="GitHub">
                                            <i class="fab fa-github"></i>
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </article>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if page_obj.has_other_pages %}
                <nav class="pagination">
                    {% if page_obj.has_previous %}
                        <a href="?page=1{% if selected_category %}&category={{ selected_category }}{% endif %}">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                        <a href="?page={{ page_obj.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}">
                            <i class="fas fa-angle-left"></i> Oldingi
                        </a>
                    {% endif %}

                    <span class="pagination-info">
                        Sahifa <strong>{{ page_obj.number }}</strong> / <strong>{{ page_obj.paginator.num_pages }}</strong>
                    </span>

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}">
                            Keyingi <i class="fas fa-angle-right"></i>
                        </a>
                        <a href="?page={{ page_obj.paginator.num_pages }}{% if selected_category %}&category={{ selected_category }}{% endif %}">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                    {% endif %}
                </nav>
            {% endif %}

        {% else %}
            <!-- Empty State -->
            <div class="empty-state">
                <i class="fas fa-folder-open"></i>
                <h3>Hech narsa topilmadi</h3>
                <p>
                    {% if search_query %}
                        "{{ search_query }}" bo'yicha hech qanday loyiha topilmadi.
                    {% else %}
                        Hozircha loyihalar yo'q. Tez orada yangi loyihalar qo'shiladi.
                    {% endif %}
                </p>
                <a href="?category=" class="btn btn-primary">
                    <i class="fas fa-redo"></i> Barcha loyihalar
                </a>
            </div>
        {% endif %}

{#        <!-- CTA Section -->#}
{#        <div class="cta" style="margin-top: 3rem; border-radius: var(--radius-xl);">#}
{#            <h2>Loyiha buyurtma qilmoqchimisiz?</h2>#}
{#            <p>Men bilan bog'laning va g'oyangizni amalga oshiramiz!</p>#}
{#            <div class="cta-buttons">#}
{#                <a href="https://t.me/abruisdev" target="_blank" class="btn btn-white">#}
{#                    <i class="fab fa-telegram"></i> Telegram#}
{#                </a>#}
{#                <a href="/#contact" class="btn btn-outline-white">#}
{#                    <i class="fas fa-envelope"></i> Bog'lanish#}
{#                </a>#}
{#            </div>#}
{#        </div>#}
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
/* ============================================================================
   PORTFOLIO PAGE STYLES
   ============================================================================ */

/* Filters */
.filters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    justify-content: center;
    margin-bottom: 2.5rem;
}

.filter-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.25rem;
    background: var(--bg-white);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-full);
    color: var(--text-light);
    font-size: 0.875rem;
    font-weight: 500;
    transition: var(--transition);
    cursor: pointer;
}

body.dark-mode .filter-btn {
    background: var(--dark-bg-secondary);
    border-color: var(--dark-border);
    color: var(--dark-text-secondary);
}

.filter-btn:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
    transform: translateY(-2px);
}

.filter-btn.active {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
}

/* Portfolio Grid */
.portfolio-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
}

/* Portfolio Card */
.portfolio-card {
    background: var(--bg-white);
    border-radius: var(--radius-xl);
    overflow: hidden;
    border: 1px solid var(--border-color);
    transition: var(--transition);
    box-shadow: var(--shadow-xs);
}

body.dark-mode .portfolio-card {
    background: var(--dark-bg-secondary);
    border-color: var(--dark-border);
}

.portfolio-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-xl);
}

/* Portfolio Image */
.portfolio-image {
    position: relative;
    height: 220px;
    overflow: hidden;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
}

.portfolio-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.portfolio-card:hover .portfolio-image img {
    transform: scale(1.1);
}

.portfolio-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 4rem;
    opacity: 0.7;
}

/* Overlay */
.portfolio-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.9), rgba(124, 58, 237, 0.9));
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: var(--transition);
}

.portfolio-card:hover .portfolio-overlay {
    opacity: 1;
}

.overlay-links {
    display: flex;
    gap: 1rem;
}

.overlay-link {
    width: 50px;
    height: 50px;
    background: white;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-color);
    font-size: 1.25rem;
    transform: translateY(20px);
    opacity: 0;
    transition: var(--transition);
}

.portfolio-card:hover .overlay-link {
    transform: translateY(0);
    opacity: 1;
}

.portfolio-card:hover .overlay-link:nth-child(2) {
    transition-delay: 0.1s;
}

.overlay-link:hover {
    background: var(--primary-color);
    color: white;
    transform: scale(1.1);
}

/* Portfolio Content */
.portfolio-content {
    padding: 1.5rem;
}

.portfolio-title {
    font-size: 1.125rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
}

body.dark-mode .portfolio-title {
    color: var(--dark-text-primary);
}

.portfolio-description {
    color: var(--text-light);
    font-size: 0.875rem;
    line-height: 1.6;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

body.dark-mode .portfolio-description {
    color: var(--dark-text-secondary);
}

/* Tech Tags */
.tech-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.tech-tag {
    padding: 0.25rem 0.625rem;
    background: var(--bg-light);
    color: var(--text-light);
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    font-weight: 500;
}

body.dark-mode .tech-tag {
    background: var(--dark-bg-tertiary);
    color: var(--dark-text-secondary);
}

/* Portfolio Footer */
.portfolio-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
}

body.dark-mode .portfolio-footer {
    border-color: var(--dark-border);
}

.portfolio-year {
    font-size: 0.8rem;
    color: var(--text-lighter);
    display: flex;
    align-items: center;
    gap: 0.375rem;
}

body.dark-mode .portfolio-year {
    color: var(--dark-text-secondary);
}

.portfolio-links {
    display: flex;
    gap: 0.5rem;
}

.portfolio-link {
    width: 34px;
    height: 34px;
    background: var(--bg-light);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-light);
    transition: var(--transition);
}

body.dark-mode .portfolio-link {
    background: var(--dark-bg-tertiary);
    color: var(--dark-text-secondary);
}

.portfolio-link:hover {
    background: var(--primary-color);
    color: white;
}

/* Pagination info */
.pagination-info {
    color: var(--text-light);
    font-size: 0.9rem;
}

body.dark-mode .pagination-info {
    color: var(--dark-text-secondary);
}

/* ============================================================================
   RESPONSIVE
   ============================================================================ */
@media (max-width: 768px) {
    .portfolio-grid {
        grid-template-columns: 1fr;
    }

    .filters {
        justify-content: flex-start;
        overflow-x: auto;
        flex-wrap: nowrap;
        padding-bottom: 0.5rem;
        -webkit-overflow-scrolling: touch;
    }

    .filter-btn {
        flex-shrink: 0;
    }

    .portfolio-image {
        height: 200px;
    }
}

@media (max-width: 480px) {
    .overlay-links {
        gap: 0.75rem;
    }

    .overlay-link {
        width: 44px;
        height: 44px;
        font-size: 1rem;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Portfolio cards animation
    const portfolioCards = document.querySelectorAll('.portfolio-card');

    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry, index) {
            if (entry.isIntersecting) {
                setTimeout(function() {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }, index * 100);
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    portfolioCards.forEach(function(card) {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
    });

    // Filter button active state (for demo without page reload)
    const filterBtns = document.querySelectorAll('.filter-btn');
    filterBtns.forEach(function(btn) {
        btn.addEventListener('click', function(e) {
            // Let the link work normally for server-side filtering
            // This is just for visual feedback
        });
    });
});
</script>
{% endblock %}